<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              warm: {
                bg: "#1C1B17", // Background utama
                text: "#F5F3F0", // Teks utama
              },
              accent: {
                primary: "#E63946", // Merah (Aksi penting)
                secondary: "#FFC857", // Emas (Sorotan/Tombol info)
                success: "#83C5BE", // Hijau mint (Indikator berhasil)
              },
              neutral: {
                odd: "#2A2925", // Baris ganjil tabel
                even: "#1C1B17", // Baris genap tabel
                border: "#FFC857", // Warna border
              },
              muted: {
                bg: "#4E4B41", // Background tombol nonaktif
                text: "#B8B5AD", // Teks nonaktif
              },
            },
          },
        },
      };
    </script>
    <style>
      /* Animasi untuk list bergerak */
      @keyframes scroll-list {
        0% {
          transform: translateY(0);
        }
        100% {
          transform: translateY(-100%);
        }
      }

      /* Animasi rotasi handle lup */
      @keyframes magnifier-handle {
        0%,
        100% {
          transform: rotate(10deg);
        }
        50% {
          transform: rotate(0deg);
        }
      }

      /* Styling list kotak */
      .list-container {
        animation: scroll-list 5s linear infinite;
      }

      /* Efek transparan pada lup */
      .glass-effect {
        background-color: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(8px);
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.2.3/css/flag-icons.min.css"
    />
  </head>

  <body class="bg-warm-bg text-warm-text">
    <header class="mt-8">
      <h1 class="font-bold text-4xl text-center text-accent-secondary">
        Welcome to the Proxy List
      </h1>
      <h5 class="text-center text-2xl mt-3 text-accent-secondary/80">
        BlueHat358
      </h5>
    </header>
    <main class="w-full">
      <div class="bg-warm-bg text-warm-text min-h-screen p-6">
        <div class="flex md:justify-between w-full mt-20">
          <div
            class="filters flex justify-between md:w-full flex-col-reverse gap-y-5 md:flex-row md:items-center md:gap-0"
          >
            <div>
              <span class="filter-label text-warm-text">Item Page:</span>
              <select
                id="items-per-page"
                class="bg-neutral-odd border-neutral-border text-warm-text rounded-md px-2 py-1"
              >
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
            <div>
              <span class="filter-label text-warm-text">Search:</span>
              <input
                type="text"
                id="search-bar"
                placeholder="Cari Isp, Country Code"
                class="bg-neutral-odd border-neutral-border border-2 rounded-md px-2 py-1 text-warm-text"
              />
            </div>
          </div>
        </div>

        <ul
          class="flex justify-center gap-1 mt-8 flex-wrap"
          id="country-list"
        ></ul>
        <div class="overflow-x-auto">
          <table class="table-auto border-collapse w-full text-center mt-8">
            <thead>
              <tr>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-12"
                >
                  No
                </th>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-60"
                >
                  IP:Port
                </th>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-60"
                >
                  ISP | Country
                </th>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-40"
                >
                  Active
                </th>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-40"
                >
                  Wildcard
                </th>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-60"
                >
                  Vless
                </th>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-40"
                >
                  Vmess
                </th>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-50"
                >
                  Trojan
                </th>
                <th
                  class="px-4 py-2 border-b text-accent-secondary font-semibold w-50"
                >
                  Shadowsock
                </th>
              </tr>
            </thead>
            <tbody
              id="proxy-list"
              class="odd:bg-neutral-odd even:bg-neutral-even"
            ></tbody>
          </table>
          <div id="fetch-div"></div>
        </div>
      </div>
      <div
        class="total-proxy w-full flex justify-center text-md mt-10 text-warm-text"
        id="total-proxy"
      ></div>
      <div
        class="pagination w-full flex flex-wrap justify-center gap-1.5 md:gap-3 mt-6 mb-32 text-accent-primary text-xs md:text-sm"
        id="pagination"
      ></div>
    </main>
  </body>
  <footer
    class="footer flex justify-center p-3 text-xs md:text-sm text-center bg-neutral-odd text-warm-text"
  >
    <h2>
      <p>
        &copy; 2024 BlueHat358 | Proudly built with Open Source Technologies.
      </p>
    </h2>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    let proxyPerPage = 10;
    let currentPage = 1;
    let filteredProxies = [];
    let allProxies = [];
    let flags = [];

    const PROXY_HEALTH_CHECK_API = "https://api-proxy.bluehat358.biz.id";

    const workerUrl = "fennekin.bluehat358.biz.id";

    // Function to handle UUID generation
    function uuidv4() {
      return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>
        (
          c ^
          (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))
        ).toString(16)
      );
    }

    // Function to render proxies
    function renderProxies(proxies, proxyList, pagination) {
      const start = (currentPage - 1) * proxyPerPage;
      const end = start + proxyPerPage;
      const currentPageProxies = proxies.slice(start, end);

      proxyList.innerHTML = ""; // Clear previous list

      currentPageProxies.forEach((proxy) => {
        const [ip, port, country, isp] = proxy.split(",");
        const uuid = uuidv4();
        const nomor = proxies.indexOf(proxy) + 1;

        const row = document.createElement("tr");
        row.className =
          "odd:bg-neutral-odd even:bg-neutral-even hover:bg-accent/50";
        row.innerHTML = `
          <!-- No -->
          <td class="px-4 py-2 border-b text-sm align-middle">${nomor}</td>
          <!-- Proxy IP -->
          <td class="px-4 py-2 border-b text-sm align-middle">${ip}:${port}</td>
          <!-- ISP | Country -->
          <td class="px-4 py-2 border-b text-sm align-middle">
            <div class="flex items-center gap-1 justify-center">
              <span>${isp}</span> | <span>${country}</span>
              <span class="fi fi-${country.toLowerCase()}"></span>
            </div>
          </td>
          <!-- Active -->
          <td class="px-4 py-2 border-b text-sm align-middle">
            <div class="flex justify-center">
              <div>
                <button
                  id="btn_active"
                  class="check_active bg-muted-bg hover:bg-muted-bg/40 text-accent-success px-2 py-1 rounded text-xs font-bold"
                  onclick="isProxyActive('${ip}', '${port}', this, ${nomor})"
                >
                  Check
                </button>
                <div
                  class="flex items-center mt-2 gap-1 hidden"
                  lat-wrap-index="${nomor}"
                >
                  <span class="bg-yellow-500 h-3 w-3 rounded-full"></span>
                  <span
                    class="text-xs text-warm-text opacity-70 latency-cell"
                  ></span>
                </div>
              </div>
            </div>
          </td>
          <!-- Wildcard -->
          <td class="px-4 py-2 border-b text-sm align-middle">
            <select
              class="w-full px-2 py-1 border rounded bg-warm-bg text-warm-text focus:ring focus:ring-warm-primary service-selector"
            >
              <option value="">No Wildcard</option>
              <option value="ava.game.naver.com">ava.game.naver.com</option>
              <option value="quiz.int.vidio.com">quiz.int.vidio.com</option>
              <option value="img.email2.vidio.com">img.email2.vidio.com</option>
              <option value="win.lipcon.com">win.lipcon.com</option>
              <option value="live.iflix.com.com">live.iflix.com</option>
              <option value="support.zoom.us">support.zoom.us</option>
              <option value="investors.spotify.com">
                investors.spotify.com
              </option>
              <option value="cache.netflix.com">cache.netflix.com</option>
              <option value="zaintest.vuclip.com">zaintest.vuclip.com</option>
              <option value="io.ruangguru.com">io.ruangguru.com</option>
            </select>
          </td>
          <!-- Vless -->
          <td class="px-4 py-2 border-b text-sm align-middle">
            <div class="flex gap-2 mb-3">
              <button
                class="copy-vless bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                Vless 443
              </button>
              <button
                class="copy-vless1 bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                Vless 80
              </button>
            </div>
            <div class="flex gap-2">
              <button
                class="copy-vless-clash bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                CLASH 443
              </button>
              <button
                class="copy-vless-clash1 bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                CLASH 80
              </button>
            </div>
          </td>
          <!-- Vmess -->
          <td class="px-4 py-2 border-b text-sm align-middle">
            <div class="flex gap-2 mb-3">
              <button
                class="copy-vmess bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                Vmess 443
              </button>
            </div>
            <div class="flex gap-2">
              <button
                class="copy-vmess1 bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                Vmess 80
              </button>
            </div>
          </td>
          <!-- Trojan -->
          <td class="px-4 py-2 border-b text-sm align-middle">
            <div class="flex gap-2 mb-3">
              <button
                class="copy-trojan bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                Trojan 443
              </button>
            </div>
            <div class="flex gap-2">
              <button
                class="copy-trojan-clash bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                CLASH 443
              </button>
            </div>
          </td>
          <!-- Shadowsock -->
          <td class="px-4 py-2 border-b text-sm align-middle">
            <div class="flex gap-2 mb-3">
              <button
                class="copy-shadowsock bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                Shadowsock 443
              </button>
            </div>
            <div class="flex gap-2">
              <button
                class="copy-shadowsock-clash bg-accent-primary/70 hover:bg-accent-secondary/60 text-warm-text px-2 py-1 rounded text-xs w-full"
              >
                CLASH 443
              </button>
            </div>
          </td>
        `;

        proxyList.appendChild(row);

        // Event listeners for copy buttons

        row.querySelector(".copy-vless").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const VLESS = `vless://${uuid}@${selectedService}:443?encryption=none&type=ws&host=${domain}&path=%2F${ip}-${port}&security=tls&sni=${domain}#(${selectedService})+${country}+${isp}`;
          navigator.clipboard.writeText(VLESS);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY VLESS 443 SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row.querySelector(".copy-vless1").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const VLESS1 = `vless://${uuid}@${selectedService}:80?encryption=none&type=ws&host=${workerUrl}&path=%2F${ip}-${port}&security=none&sni=#(${selectedService})+${country}+${isp}`;
          navigator.clipboard.writeText(VLESS1);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY VLESS 80 SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row.querySelector(".copy-vless-clash").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const VLESSC = `- name: (${selectedService})+${country}+${isp}
      server: ${selectedService}
      port: 443
      type: vless
      uuid: ${uuid}
      cipher: auto
      tls: true
      udp: true
      skip-cert-verify: true
      network: ws
      servername: ${domain}
      ws-opts:
        path: /${ip}-${port}
        headers:
          Host: ${domain}`;
          navigator.clipboard.writeText(VLESSC);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY VLESS CLASH 443 SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row
          .querySelector(".copy-vless-clash1")
          .addEventListener("click", () => {
            const selectedService =
              row.querySelector(".service-selector").value || workerUrl;
            const domain =
              selectedService === workerUrl
                ? workerUrl
                : `${selectedService}.${workerUrl}`;
            const VLESS2 = `- name: (${selectedService})+${country}+${isp}
      server: ${selectedService}
      port: 80
      type: vless
      uuid: ${uuid}
      cipher: auto
      tls: false
      skip-cert-verify: false
      servername: ${workerUrl}
      network: ws
      ws-opts:
        path: /${ip}-${port}
        headers:
          Host: ${workerUrl}
      udp: true `;
            navigator.clipboard.writeText(VLESS2);
            Swal.fire({
              title: "Berhasil!",
              text: "COPY VLESS CLASH 80 SUKSES!",
              icon: "success",
              background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
              color: "cyan", // Warna teks
              customClass: {
                popup: "rounded-popup",
              },
              confirmButtonColor: "#3085d6",
            });
          });

        row.querySelector(".copy-vmess").addEventListener("click", () => {
          console.log("Copy Vmess 443 clicked");
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;

          const config = {
            ps: `(${selectedService})+${country}+${isp}`,
            v: "2",
            add: domain,
            port: "443",
            id: uuid,
            aid: "0",
            scy: "zero",
            net: "ws",
            type: "none",
            host: domain,
            path: `/${ip}-${port}`,
            tls: "true",
            sni: domain,
            alpn: "",
          };

          // Encode ke base64 URL-safe (mengganti + dan / menjadi - dan _)
          const jsonString = JSON.stringify(config);
          const base64 = btoa(jsonString)
            .replace(/\+/g, "-")
            .replace(/\//g, "_")
            .replace(/=+$/, "");

          const vmessLink = `vmess://${base64}`;

          navigator.clipboard.writeText(vmessLink);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY VLESS 443 SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row.querySelector(".copy-vmess1").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;

          const config = {
            ps: `(${selectedService})+${country}+${isp}`,
            v: "2",
            add: domain,
            port: "80",
            id: uuid,
            aid: "0",
            scy: "zero",
            net: "ws",
            type: "none",
            host: domain,
            path: `/${ip}-${port}`,
            tls: "",
            sni: "",
            alpn: "",
          };

          // Encode ke base64 URL-safe (mengganti + dan / menjadi - dan _)
          const jsonString = JSON.stringify(config);
          const base64 = btoa(jsonString)
            .replace(/\+/g, "-")
            .replace(/\//g, "_")
            .replace(/=+$/, "");

          const vmessLink = `vmess://${base64}`;

          navigator.clipboard.writeText(vmessLink);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY VLESS 443 SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row.querySelector(".copy-trojan").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const TROJAN = `trojan://${uuid}@${selectedService}:443?encryption=none&type=ws&host=${domain}&path=%2F${ip}-${port}&security=tls&sni=${domain}#(${selectedService})+${country}+${isp}`;
          navigator.clipboard.writeText(TROJAN);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY TROJAN SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row
          .querySelector(".copy-trojan-clash")
          .addEventListener("click", () => {
            const selectedService =
              row.querySelector(".service-selector").value || workerUrl;
            const domain =
              selectedService === workerUrl
                ? workerUrl
                : `${selectedService}.${workerUrl}`;
            const TROJANC = `- name: (${selectedService})+${country}+${isp}
        server: ${selectedService}
        port: 443
        type: trojan
        password: ${uuid}
        skip-cert-verify: true
        sni: ${domain}
        network: ws
        ws-opts:
          path: /${ip}-${port}
          headers:
            Host: ${domain}
        udp: true `;
            navigator.clipboard.writeText(TROJANC);
            Swal.fire({
              title: "Berhasil!",
              text: "COPY TROJAN CLASH SUKSES!",
              icon: "success",
              background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
              color: "cyan", // Warna teks
              customClass: {
                popup: "rounded-popup",
              },
              confirmButtonColor: "#3085d6",
            });
          });

        row.querySelector(".copy-shadowsock").addEventListener("click", () => {
          const selectedService =
            row.querySelector(".service-selector").value || workerUrl;
          const domain =
            selectedService === workerUrl
              ? workerUrl
              : `${selectedService}.${workerUrl}`;
          const SS = `ss://bm9uZTo1ZDJlYmQyYS05Y2I5LTRkMWItYWY1NS04NjE3ZDNlODFmMzk%3D@${selectedService}:443?encryption=none&type=ws&host=${domain}&path=%2F${ip}-${port}&security=tls&sni=${domain}#(${selectedService})+${country}+${isp}`;
          navigator.clipboard.writeText(SS);
          Swal.fire({
            title: "Berhasil!",
            text: "COPY SHADOWSOCK SUKSES!",
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
            color: "cyan", // Warna teks
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        });

        row
          .querySelector(".copy-shadowsock-clash")
          .addEventListener("click", () => {
            const SS1 = `087861167414`;
            navigator.clipboard.writeText(SS1);
            Swal.fire({
              title: "Perhatian!",
              text: "SHADOWSOCK VERSI CLASH BELUM TERSEDIA",
              icon: "warning",
              background: "rgba(6, 18, 67, 0.89)", // Warna latar belakang (biru pucat)
              color: "cyan", // Warna teks
              customClass: {
                popup: "rounded-popup",
              },
              confirmButtonColor: "#f39c12",
            });
          });
      });

      // Display total proxies
      const totalProxies = proxies.length;
      const totalProxyElement = document.getElementById("total-proxy");
      if (totalProxyElement) {
        totalProxyElement.textContent = `Total Proxies: ${totalProxies}`;
      }

      renderPagination(proxies, pagination);
    }

    // Function to render pagination
    function renderPagination(proxies, pagination) {
      const totalPages = Math.ceil(proxies.length / proxyPerPage);
      const maxButtons = 6;
      pagination.innerHTML = "";

      if (currentPage > 1) {
        const firstButton = document.createElement("button");
        firstButton.className =
          "border-accent-primary  hover:bg-accent-primary/40 md:text-sm text-xs text-accent-secondary border-2 rounded-md py-1 px-2 mt-4";
        firstButton.textContent = "<< First";
        firstButton.addEventListener("click", () =>
          updatePage(1, proxies, pagination)
        );
        pagination.appendChild(firstButton);

        const prevButton = document.createElement("button");
        prevButton.className =
          "border-accent-primary  hover:bg-accent-primary/40 md:text-sm text-xs text-accent-secondary border-2 rounded-md py-1 px-2 mt-4";
        prevButton.textContent = "Previous";
        prevButton.addEventListener("click", () =>
          updatePage(currentPage - 1, proxies, pagination)
        );
        pagination.appendChild(prevButton);
      }

      const startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
      const endPage = Math.min(totalPages, startPage + maxButtons - 1);

      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement("button");
        pageButton.className =
          "border-accent-primary  hover:bg-accent-primary/40 md:text-sm text-xs text-accent-secondary border-2 rounded-md py-1 px-2 mt-4";

        pageButton.textContent = i;
        if (i === currentPage) {
          pageButton.classList.add("active");
          pageButton.className =
            "bg-accent-primary/50 border-accent-primary md:text-sm text-xs border-2 text-warm-text rounded-md py-1 px-2 mt-4";
        }
        pageButton.addEventListener("click", () =>
          updatePage(i, proxies, pagination)
        );
        pagination.appendChild(pageButton);
      }

      if (currentPage < totalPages) {
        const nextButton = document.createElement("button");
        nextButton.className =
          "border-accent-primary  hover:bg-accent-primary/40 md:text-sm text-xs text-accent-secondary border-2 rounded-md py-1 px-2 mt-4";
        nextButton.textContent = "Next";
        nextButton.addEventListener("click", () =>
          updatePage(currentPage + 1, proxies, pagination)
        );
        pagination.appendChild(nextButton);

        const lastButton = document.createElement("button");
        lastButton.className =
          "border-accent-primary hover:bg-accent-primary/40 md:text-sm text-xs text-accent-secondary border-2 rounded-md py-1 px-2 mt-4";
        lastButton.textContent = "Last >>";
        lastButton.addEventListener("click", () =>
          updatePage(totalPages, proxies, pagination)
        );
        pagination.appendChild(lastButton);
      }
    }

    // Function to update page
    function updatePage(page, proxies, pagination) {
      currentPage = page;
      const proxyList = document.getElementById("proxy-list");
      renderProxies(proxies, proxyList, pagination);
    }

    // Function to filter proxies
    function filterProxies(searchTerm) {
      const elementLi = document.getElementById("country-list");
      const activeItems = document.querySelectorAll("#country-list li");
      const elementSpan = elementLi.querySelector("span");

      activeItems.forEach((li) => {
        li.classList.remove("bg-accent-primary/80");
        const span = li.querySelector("span");
        if (span) span.classList.remove("opacity-60");
      });

      searchTerm = searchTerm.toLowerCase();
      filteredProxies = allProxies.filter((proxy) =>
        proxy.toLowerCase().includes(searchTerm)
      );
      currentPage = 1;
      const proxyList = document.getElementById("proxy-list");
      const pagination = document.getElementById("pagination");
      renderProxies(filteredProxies, proxyList, pagination);
    }

    // Event listener for search bar
    document.getElementById("search-bar").addEventListener("input", (e) => {
      filterProxies(e.target.value);
    });

    // Event listener for items per page dropdown
    document
      .getElementById("items-per-page")
      .addEventListener("change", (e) => {
        proxyPerPage = parseInt(e.target.value);
        const proxyList = document.getElementById("proxy-list");
        const pagination = document.getElementById("pagination");
        renderProxies(filteredProxies, proxyList, pagination);
      });

    // Display loading animation
    let isLoading = true;
    const loadingDiv = document.getElementById("fetch-div");
    loadingDiv.className =
      "relative flex items-center justify-center w-full max-w-md overflow-hidden justify-self-center mt-40";

    if (isLoading) {
      renderFetchDataAnimation(loadingDiv);
    }

    // Fetching proxy data
    fetch(
      "https://raw.githubusercontent.com/BlueHat358/bluehat358-tunnel/refs/heads/main/proxy_list_active.txt"
    )
      .then((response) => response.text())
      .then((data) => {
        allProxies = data.split("\n").filter((line) => line.trim() !== "");
        filteredProxies = allProxies;
        const proxyList = document.getElementById("proxy-list");
        const pagination = document.getElementById("pagination");
        renderProxies(filteredProxies, proxyList, pagination);
        renderFlags(filteredProxies);

        isLoading = false;
        loadingDiv.remove();
      })
      .catch((error) => {
        console.error("Error fetching proxy data:", error);

        loadingDiv.textContent = "Gagal memuat data. Silakan coba lagi.";
        loadingDiv.className =
          "absolute w-fit top-3/4 left-1/2 -translate-x-1/2 bg-red-500 px-4 py-2 rounded-lg shadow-lg text-red-200 font-bold text-lg";
      }); // Correct placement here

    // Check Proxy isActive function
    async function isProxyActive(ip, port = "443", button, index) {
      const latencyCell = button.parentElement.querySelector(".latency-cell"); // Find the latency span in the same cell
      let latencyWrapper = document.querySelector(
        `[lat-wrap-index="${index}"]`
      );
      const host = "speed.cloudflare.com";
      const tls = "true";
      let endTime = 0;
      let latency = 0; // Calculate latency
      let url = `${PROXY_HEALTH_CHECK_API}?ip=${ip}&port=${port}&host=${host}&tls=${tls}`;

      button.textContent = "Checking...";

      let startTime = performance.now();
      try {
        const response = await fetch(url, { method: "GET" }).then(
          (response) => {
            endTime = performance.now();
            latency = (endTime - startTime).toFixed(2); // Calculate latency
            return response;
          }
        );

        // Explicitly check if HTTP response is not OK
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        // Parse JSON response
        const data = await response.json();

        // Extract proxy status from response
        const isProxy = data.proxyip ? "Yes" : "No";

        if (isProxy === "Yes") {
          latencyWrapper.classList.remove("hidden");
          button.textContent = "ACTIVE";
          button.style.backgroundColor = "green";
          button.style.color = "cyan";
          latencyCell.textContent = `${latency} ms`;

          // Display success popup
          Swal.fire({
            title: "Proxy Status: ACTIVE",
            text: `${latency} ms.`,
            icon: "success",
            background: "rgba(6, 18, 67, 0.89)",
            color: "cyan",
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#3085d6",
          });
        } else {
          button.textContent = "DEAD";
          button.style.backgroundColor = "red";
          button.style.color = "cyan";
          latencyCell.textContent = "";

          // Display error popup
          Swal.fire({
            title: "Proxy Status: DEAD",
            text: "Proxy is not active.",
            icon: "error",
            background: "rgba(6, 18, 67, 0.89)",
            color: "white",
            customClass: {
              popup: "rounded-popup",
            },
            confirmButtonColor: "#d33",
          });
        }
      } catch (error) {
        console.error("Error:", error);

        endTime = performance.now();
        latency = (endTime - startTime).toFixed(2); // Calculate latency even in error case

        button.textContent = "DEAD";
        button.style.backgroundColor = "red";
        button.style.color = "cyan";
        latencyCell.textContent = ""; // Clear latency cell text on failure

        // Display error popup
        Swal.fire({
          title: "Proxy Status: DEAD",
          text: `Error: ${error.message}`,
          icon: "error",
          background: "rgba(6, 18, 67, 0.89)",
          color: "white",
          customClass: {
            popup: "rounded-popup",
          },
          confirmButtonColor: "#d33",
        });
      }
    }

    function renderFlags(proxies) {
      const flagList = document.getElementById("country-list");

      proxies.forEach((proxy) => {
        const [ip, port, country, isp] = proxy.split(",");
        if (!flags.includes(country.toLowerCase())) {
          flags.push(country.toLowerCase()); // Menambahkan negara jika belum ada
        }
      });

      flags.forEach((flag) => {
        const flagElement = document.createElement("li");
        flagElement.className =
          "border-2 border-accent-primary w-12 h-12 px-1 rounded-md flex items-center hover:cursor-pointer hover:bg-accent-primary/80";
        flagElement.setAttribute(
          "onclick",
          `filterByCountry('${flag}', this);`
        );
        flagElement.setAttribute("countryIdLi", `id-${flag.toUpperCase()}`);
        flagElement.innerHTML = `<span class="fi fi-${flag} w-full h-full hover:opacity-60" countryIdSpan="id-${flag.toUpperCase()}"></span>`;
        flagList.appendChild(flagElement);
      });
    }

    // Function to filter proxies by country
    function filterByCountry(countrySearch, elementLi) {
      const searchInput = document.getElementById("search-bar");
      const activeItems = document.querySelectorAll("#country-list li");
      const elementSpan = elementLi.querySelector("span");
      const isActive = elementLi.classList.contains("active");

      searchInput.value = "";

      if (isActive) {
        elementLi.classList.remove("active", "bg-accent-primary/80");
        elementSpan.classList.remove("active", "opacity-60");

        filteredProxies = allProxies;
      } else {
        activeItems.forEach((li) => {
          li.classList.remove("active", "bg-accent-primary/80");
          const span = li.querySelector("span");
          if (span) span.classList.remove("active", "opacity-60");
        });

        elementLi.classList.add("active", "bg-accent-primary/80");
        elementSpan.classList.add("active", "opacity-60");

        filteredProxies = allProxies.filter((proxy) => {
          const [ip, port, country, isp] = proxy.split(",");
          return country.toUpperCase() === countrySearch.toUpperCase();
        });
      }

      currentPage = 1;
      const proxyList = document.getElementById("proxy-list");
      const pagination = document.getElementById("pagination");
      renderProxies(filteredProxies, proxyList, pagination);
    }

    // Function to render loading animation
    function renderFetchDataAnimation(element) {
      element.innerHTML = `
        <!-- Kotak List -->
        <div class="relative w-full h-64 overflow-hidden">
          <div class="list-container absolute w-full space-y-4">
            <!-- Duplikasi kotak untuk loop -->
            <div class="flex items-center p-4 bg-accent-primary/60 rounded-lg shadow-md">
              <div class="w-12 h-12 bg-neutral-even/80 rounded-full"></div>
              <div class="ml-4">
                <div class="h-4 bg-neutral-even/50 rounded w-32"></div>
                <div class="h-4 bg-neutral-even/50 rounded w-24 mt-2"></div>
              </div>
            </div>
            <div class="flex items-center p-4 bg-accent-primary/60 rounded-lg shadow-md">
              <div class="w-12 h-12 bg-neutral-even/80 rounded-full"></div>
              <div class="ml-4">
                <div class="h-4 bg-neutral-even/50 rounded w-32"></div>
                <div class="h-4 bg-neutral-even/50 rounded w-24 mt-2"></div>
              </div>
            </div>
            <div class="flex items-center p-4 bg-accent-primary/60 rounded-lg shadow-md">
              <div class="w-12 h-12 bg-neutral-even/80 rounded-full"></div>
              <div class="ml-4">
                <div class="h-4 bg-neutral-even/50 rounded w-32"></div>
                <div class="h-4 bg-neutral-even/50 rounded w-24 mt-2"></div>
              </div>
            </div>
            <!-- Duplikat untuk seamless loop -->
            <div class="flex items-center p-4 bg-accent-primary/60 rounded-lg shadow-md">
              <div class="w-12 h-12 bg-neutral-even/80 rounded-full"></div>
              <div class="ml-4">
                <div class="h-4 bg-neutral-even/50 rounded w-32"></div>
                <div class="h-4 bg-neutral-even/50 rounded w-24 mt-2"></div>
              </div>
            </div>
            <div class="flex items-center p-4 bg-accent-primary/60 rounded-lg shadow-md">
              <div class="w-12 h-12 bg-neutral-even/80 rounded-full"></div>
              <div class="ml-4">
                <div class="h-4 bg-neutral-even/50 rounded w-32"></div>
                <div class="h-4 bg-neutral-even/50 rounded w-24 mt-2"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Lup -->
        <div
          class="absolute flex items-center justify-center transform rotate-45"
        >
          <!-- Kaca Lingkaran -->
          <div
            class="glass-effect w-32 h-32 border-8 bg-transparent border-accent-secondary/70 rounded-full flex items-center justify-center"
          >
            <!-- Efek loading lingkaran -->
            <div
              class="w-24 h-24 border-4 border-t-accent-secondary/50 border-l-accent-secondary/20 border-r-accent-secondary/70 border-b-transparent rounded-full animate-spin"
            ></div>
          </div>
          <!-- Handle Lup -->
          <div
            class="w-4 h-20 bg-accent-secondary/70 absolute top-[7.5rem] left-15 origin-top animate-[magnifier-handle_1s_ease-in-out_infinite] rounded-full"
          ></div>
        </div>
      `;
    }
  </script>
</html>
